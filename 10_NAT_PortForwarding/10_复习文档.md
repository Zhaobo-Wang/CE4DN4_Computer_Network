## NAT的作用

NAT（网络地址转换）是一种网络技术，主要用于IP地址的转换和管理。它在当前的网络架构中扮演着重要的角色，尤其是在家庭网络和企业网络中。以下是NAT的主要用途和功能：

### 1. IP地址保护和隐藏：

NAT可以将私有（非全球唯一）IP地址转换为公共IP地址，反之亦然。这意味着多个设备可以共享一个公共IP地址来访问互联网，而它们各自的私有IP地址则对外界保持隐藏。这样做不仅可以节省公共IP地址资源（尤其是在IPv4的环境下），还可以增加网络的安全性，因为外部网络不能直接访问内部网络中的特定设备。

### 2. 端口转发：

NAT允许网络管理员将公共IP地址上特定的端口请求转发到内网中特定的IP地址和端口。这在需要从外部网络访问内部网络中的服务器（例如Web服务器、游戏服务器等）时非常有用。通过端口转发，外部用户可以通过访问具有公共IP的网络设备来连接到内部网络中的服务，而不必直接公开该服务的内部IP地址。

### 3. 支持多设备联网：

在家庭和小型企业网络中，通常只有一个公共IP地址可用。通过使用NAT，多个设备（如手机、电脑、平板等）可以通过一个路由器同时连接到互联网。每个设备都有自己的私有IP地址，但它们共享同一个公共IP地址进行外部通信。





### NAT的工作原理：

想象你的家里有多部设备（如手机、电脑和平板），每个设备都有自己的私有IP地址，这些地址只在你家的网络中有效。但是，当这些设备想要接入互联网时，它们需要一个公共IP地址。这是因为私有IP地址是不被互联网路由器识别的。

这时，NAT就发挥作用了：它位于你的路由器（通常是家庭路由器）中，当你的设备试图与互联网上的服务（比如一个网站）通信时，NAT会将你设备的私有IP地址转换成一个公共IP地址（这通常是你的路由器从ISP获得的地址）。这样，来自多个设备的请求就都可以通过一个公共IP地址发送到互联网上。

当来自互联网的数据回传给那个公共IP时，NAT再将那个公共IP地址转换回原始的私有IP地址，确保数据正确送达发起请求的设备。

### NAT vs IP Masquerading：

**IP Masquerading** 是NAT的一种形式，通常指的是在Linux系统中使用的一种技术。IP Masquerading可以让家庭或小型办公室网络中的多个设备共享一个公共IP地址进行互联网通信。这种方式实际上“伪装”了内部设备的真实IP地址，对外只展示一个IP地址。这在技术上被称作“源NAT”，其中源地址被替换为另一个地址。

在日常用语中，NAT和IP Masquerading经常被混用，尽管IP Masquerading严格来说是NAT的一个子集，特指源地址转换（主要用于Linux iptables中）。

### 举个例子：

假设你的家庭有三台设备，每一台都想访问Google。它们各自有私有IP地址，比如192.168.1.2、192.168.1.3和192.168.1.4。你的家庭只拥有一个公共IP地址，比如203.0.113.1。

* 当这三台设备通过你的路由器访问Google时，它们的请求会发送到你的路由器上。
* 路由器执行NAT操作，将每个请求的源IP地址（私有地址）替换为路由器的公共IP地址（203.0.113.1），但会为每个会话分配不同的端口号。
* Google服务器看到的只是来自203.0.113.1的请求，但不知道实际上背后有三台不同的设备。
* 当Google回应这些请求时，它们都发送到了公共IP（203.0.113.1）。一旦数据到达你的路由器，NAT机制就会根据之前创建的会话信息，将数据正确地转发到原始请求的设备上（192.168.1.x）。

这就是NAT的一个基本例子，**它展示了如何使多个设备能够共享单一的公共IP地址进行互联网通信**。



NAT遍历（NAT Traversal）是一种技术，旨在解决在网络地址转换（NAT）环境中进行端对端通信的问题。因为NAT更改了通过它的数据包的IP地址和端口信息，所以当两个位于不同NAT背后的设备想要直接连接时，会遇到问题，尤其是当它们试图建立从外部世界到NAT背后设备的连接时。

### NAT Traversal的工作原理：

NAT遍历技术的目的是允许位于私有网络（例如家庭或企业网络）后面的设备，能够发起或接收从互联网来的连接，即使这些设备没有一个公共的、可从互联网直接访问的IP地址。

### NAT Traversal的例子：

假设你在家里使用Skype或任何其他VoIP服务拨打或接收电话。你的设备（比如你的笔记本电脑或智能手机）位于家庭网络的NAT后面。当你拨打电话时，你的VoIP客户端软件将使用NAT Traversal技术（如STUN）来确定你的公共IP地址和端口，这样外部世界就能与你的设备建立直接连接，即使实际IP地址被NAT隐藏了。

总之，NAT Traversal是解决NAT带来的通信限制问题的关键技术，使得位于NAT后面的设备能够参与到更广泛的互联网通信中去。







# Port Forwarding 端口转发

端口转发（Port Forwarding）是网络地址转换（NAT）的一种功能，它允许外部设备通过特定的端口访问网络内部（私有网络）的特定设备和服务。在家庭网络或小型企业网络中，通常是通过路由器或防火墙实现的。

### 端口转发的工作原理：

1. 在路由器上设置端口转发规则，指定外部网络请求的特定端口号。
2. 当来自互联网的请求到达路由器上这个指定的端口时，路由器根据设定的规则，将这些请求转发到内部网络中的特定设备和端口。
3. 内部设备处理这些请求并响应，响应数据再通过路由器发送回请求的外部设备。

### 举个例子：

如果你在家里有一个私人服务器（比如用于远程桌面连接、FTP服务或游戏服务器），你可能想从家以外的地方访问这台服务器。由于家用路由器通常使用NAT，所以你需要在路由器上设置端口转发，以便能从外部网络访问这台内部服务器。

<img title="" src="file:///C:/Users/wangz/OneDrive/Pictures/Typedown/3f790ea9-774e-4ad6-a33b-62b8cfc2707f.png" alt="3f790ea9-774e-4ad6-a33b-62b8cfc2707f" style="zoom:33%;">

### 根据你提供的截图说明：

截图显示的是路由器的端口转发设置界面。它展示了如何设置不同服务的端口转发规则：

- **ssh to hornet**: 这可能表示当外部请求到达端口2050时，路由器会将这些请求转发到内部网络中IP地址为192.168.1.22的设备上的22号端口（通常是SSH服务的标准端口）。

- **ssh to crow**: 同样，外部的2020端口的流量会被转发到内网的192.168.1.10设备上的22号端口。

- **RPI Menu SSL**：443端口的流量（通常用于HTTPS）被转发到192.168.1.22的443端口。

- 其他规则也按照相似的模式设置。

总之，这个界面和这些规则使得用户可以从家庭网络外部访问内部网络中特定设备上的特定服务。这对于远程工作、远程控制或在线游戏等场景非常有用。




